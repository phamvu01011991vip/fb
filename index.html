<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Phân UID Facebook đều cho từng người</h1>
        <div class="muted">Nhập danh sách UID (mỗi UID 1 dòng hoặc cách nhau bằng khoảng trắng) và danh sách tên (phân tách bằng dấu phẩy)</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">100002934322792
100038580533360
100013851108872
100042084361303
100044785604433
100029875929057
100055138895883
100035340398054
100012118217304
100001163041416
100001449536633
100005585027763
100022912683759
100028272064655
100010910474139
100050402768810
100091524775188
100008043967620
100048950010066
100017497111716
100011546640250
100000799696646
100015645044820
100051884895197
100054247428390
100015198603707
100030437527100
100015154572430
100005222474652
100025679057660
100025848498625
100018713421320
100010091712669
100024210391327
100006067445295
100027997880914
100007467702011
100008777229840
100000841040790
100010003938391
100024560233432
100035958894046
100000868540632
100019426800816
100010549968234
100005558743798
100015415182085
100008302123663
100010414719739
100021693459567
100072221031264
100022369836417
100005419148533
100049247834496
100026716241380
100027277792289
100010085133071
100028132966393
100008537353739
100029196063632
100046025203021
100046383542411
100050342580680
100095136652622
100041540926281
100025802723294
100023879719601
100022745631269
100009655116274
100026581711431
100024621213361
100082477516384
100065555287518
100087526476990
100041910123352
100022184565067
100057702754799
100010368730773
100017566951666
61557144331169
100021880987227
100024249661399
100072678467025
100015494620841
100060314720364
100011634453036
100011406673674
100076332491207
100021470251117
61570230996104
100043028460065
100021942885727
100005719788945
100047655122555
100027732633948
61560297011901
100051598232735
100055860758649
100034364539431
100069381938849
100052943865284
100022174719668
100075683380967
100042970746257
100047230324197
100088981797932
100052044950362
100066514629568
100044876049987
61579314117490
61579249562420
61579243863020
100052529931974
100010202792442
61579371656859
100088564120897
100013037475072
100008220460553
61579108032937
100023610615037
100008217918799
100011094192974
100016352145369
100090480728518
61554910235156
100040641162073
100084370080471
100051928923323
100046652881143
100053840927126
100025994691643
100039042200915
100066675673230
100070961090735
100075185737636
100058905391396
100073947038854
100074793813969
100077655042168
100055623800888
100004145706628
100021655970519
100040255127078
100040709837984
100012591937646
100042823683538
100043312925678
100074166262016
100008517421474
100069517735756
100034422763031
100070134200194
100080463555802
61575829195481
100054435604716
100053558401473
100035135003987
100005302448897
100024581925346
100015555524842
100093179376978
61575799750332
61574878144349
61564415635839
100032059830630
61575160715449
100052853733422
100023302210476
100074642451547
100064865899223
100060762293741
100050649678743
100013812612374
100009439059773
100006647226328
100051327229291
61574104882256
61578901694405
100035925182675
100065680252685
100011313900664
100042849214147
100023918912814
100005647778726
100074363193328
100041742752882
100034756214394
100041182689346
100055246603142
61558558425084
100050330962100
61556586001060
100015966619184
100068062555635
100063804334689
100046527943486
100002384531444
100009503983024
100001261153602
100055307902206
100089674282506
100024061902277
100053423176737
100013060920528
100022772630184
100081351956236
100040719619293
100027688060294
100013956433558
100005160483956
100033283371144
100011582375045
100052014519112
100019060435551
100053732254308
100013596155282
61565783946808
100045727060802
61566208350841
100025265252997
100046618897132
100011495327041
100037705821441
100065988565346
100065422263753
100020722624935
100020723434798
100089998067956
100021327104337
100045345343142
100065661632665
61555476031811
100042463127272
100034115000002
100037811563132
100065494877070
100041108888703
100009046581566</textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,dương,việt anh,quang huy,tô lâm" />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Ghi chú: thuật toán sẽ chia theo vòng (round‑robin) để mỗi người có chênh lệch không quá 1 UID.</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>