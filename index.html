<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
61552191285184
61552189717831
61552167081919
61552144554384
61552136537914
61552131917857
61552129847630
61552128985595
61552128685750
61552118846057
61552105397759
61552104594843
61552095207454
61552084255787
61552074718166
61552061367329
61552025220520
61551989760514
61551988416050
61551940472048
61551913055365
61551903036658
61551877627660
61551838449483
61551837429434
61551764741162
61551747674433
61551742365033
61551357314563
100094627650084
100094619730361
100094612080757
100094597531453
100094587270361
100094585830521
100094579680770
100094577790666
100094576741060
100094552832044
100094546592360
100094546022309
100094540832696
100094539994427
100094530783380
100094508791327
100094505794195
100094504084272
100094502734324
100094495474731
100094493616565
100094491305105
100094491245238
100094471805712
100094444986862
100094437187229
100094426267790
100094411448569
100094411148513
100094409918561
100094403948974
100094402059168
100094396241095
100094394349338
100094384451531
100094381150119
100094369180756
100094336932394
100094325562219
100094323254633
100094320703021
100094309003704
100094307055847
100094299555896
100094296884232
100094293284668
100094290284942
100094284284895
100094281854866
100094281015472
100094278045143
100094274805263
100094272767397
100094265805929
100094264157418
100094257196608
100094242408928
100094232717661
100094231729657
100094231367461
100094224318111
100094214058586
100094196539328
100094188349713
100094184361932
100094168100910
100094164951104
100094162251171
100094161471859
100094161169581
100094155863230
100094152171745
100094143413726
100094137292743
100094128862786
100094107294192
100094106186047
100094105285827
100094102074172
100094091004912
100094089145063
100094087255178
100094081135169
100094080625579
100094078285781
100094076337518
100094075885747
100094071567750
100094064426487
100094059116685
100094058336665
100093044941150
100093014433793
100092883698251
100092873708084
100092852618791
100092763727734
100092750201038
100092695937138
100092692080662
100092692037313
100092677621252
100092668771764
100092666468261
100092665638408
100092657072104
100092621870522
100092604784924
100092594620321
100092589822700
100092579883439
100092577183823
100092559036077
100092556126393
100092554903485
100092546406732
100092542836852
100092527372187
100092524387981
100092522048335
100092516918350
100092513514565
100092489979143
100092485336912
100092483246057
100092465537696
100092463940693
100092450921248
100092444641205
100092437002378
100092409873170
100092395243961
100092379753276
100092377864366
100092366315158
100092360865883
100092345573611
100092344396714
100092336267680
100092318616951
100092317656894
100092312408047
100092301768998
100092293806334
100092270930579
100092268860727
100092264151236
100092246181799
100092217066117
100092214594093
100092214543455
100092203212594
100092169042868
100092144184598
100092133504888
100092048322906
100092016147346
100092015217272
100092013314125
100091976261354
100091965706020
100091945843772
100091913059633
100091909758411
100091882253099
100091852133918
100091850537933
100091850034669
100091816621044
100091805700313
100091802996039
100091770926887
100091735562615
100091578278524
100091575969269
100091539824029
100091455540433
100091387338132
100091363502101
100091322703401
100091317367645
100091300256197
100091131117056
100091112200527
100091091487401
100091054061112
100091000872988
100090990698650
100090966884759
100090966819955
100090929411503
100090889080087
100090870078491
100090866804003
100090858944085
100090848504809
100090811642109
100090782620791
100090755539501
100090754314410
100090745155977
100090734030493
100090725210485
100090717006396
100090715266183
100090715236239
100090714801031
100090692037022
100090691072130
100090684696214
100090653363531
100090641574406
100090586669564
100090581170407
100090574891916
100090557645205
100090553188878
100090533110299
100090480574245
100090424007152
100090412537365
100090391568310
100090389598702
100090371229548
100090348212839
100090334322221
100090310266719
100090302911420
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm, phạm văn, đức dương, phan kiên, thiện trí, khẩn " />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên"</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>