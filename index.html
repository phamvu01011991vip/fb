<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Phân UID Facebook đều cho từng người</h1>
        <div class="muted">Nhập danh sách UID (mỗi UID 1 dòng hoặc cách nhau bằng khoảng trắng) và danh sách tên (phân tách bằng dấu phẩy)</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">100065580192007
100089958021918
100033791558705
100049061379636
100072050088586
61551062199923
100025262011906
61561202848736
100040474399868
100079688569896
100087506482537
61567798715754
100083107320167
100022030800630
100084019114923
100051406452085
100082480039741
100027724700782
100064566157512
100090728251070
100088837004408
100083103468762
100025350519508
100068584190220
61550866782387
61554173877308
100078977647529
100044876049987
61579314117490
61579249562420
61579243863020
100052529931974
100010202792442
61579371656859
100088564120897
100013037475072
100008220460553
61579108032937
100023610615037
100008217918799
100011094192974
100016352145369
100090480728518
61554910235156
100040641162073
100084370080471
100051928923323
61579336954018
100026641545949
100044953325897
100028279360387
100035358923672
100080491933918
100041419281112
100004632367866
100053168211806
61580059850377
61550753971072
100034474667930
100052012413775
100012525966840
100045281898627
100060272880752
100029318709005
100058204930311
100028175747982
100048767102741
100026192621357
100023520948744
100009584831951
100016755885995
100053177810597
61557117793993
100080250294337
100048208759140
100055335046431
100029095274248
100007518517485
61565582132986
100048957163807
100061058678056
100087199126663
100006940635213
100041831860137
100011384325625
100010257102498
100041349782191
100068220126386
100020985690391
100038256580280
100080464124115
100077545808990
100084485259432
100047150434845
100014403391450
100031991655275
100015823988389
100035036196519
100042991252100
100034482802912
100033583209140
100033545118556
61576338533691
100065762014180
100046695849949
100007265888606
100010057090582
100046656429862
100025139798158
100026395822867
100082889441135
100039234560048
100068491844234
100055272115210
100077933198916
100006850301922
100023936479618
100005477493566
100058608186512
100056063205103
100005951719492
61577370669112
100005310251126
100039517628763
100008095473723
100024780782529
61576028561767
100031133689254
100067617678606
100095110424948
100012054847720
100009327637270
100052603921148
100046808228829
100087106670856
100093504791791
100073581163707
100039971571609
100051628126310
100081166718696
100091351130652
61581126115530
61581060626309
100073963225812
100066564880592
100038078152261
61578347399476
61579045899111
61578950743186
100049517280264
100006677924574
61550344031130
100069561451602
100074304260155
61574781624775
100021396150365
100045924110602
100086611890246
61579832948241
61581272099791
100041506087180
100043098638160
100078309379714
100046222987622
100038041462594
61576279236092
100043264476657
100039588453450
61581050474386
61581474860825
61581167792482
100017387620593
100025384445770
100024097775263
61574479325602
100023619532897
100015025503285
100083320834039
100025749450913
100049852923590
100031821530225
61566093575908
100036709711002
100038925774043
100017326384279
100086591023016
100012040392394
100007553986807
100027116662546
100067169856376
100029977832828
100045670662106
100060500992981
100035414495952
100045533718655
100082960450132
100035338641802
100035230610858
100041943938103
100013104367674
100046179101136
100022405297567
61577299824979
100040625504833
61574075371071
100024554451280
100009002090706
100076295741881
100092037450265
100034299219246
100094695687702
100053027531801
100089573051248
100030212670710
100036244971449
100049936235872
100046684623612
100037232742143
100085925372078
100070297336370
100046104639247
100030447323692
100028009000946
100023357135003
100040147986992
100031452870602
100025445260292
100048770808367
100080064943387
100041239839759
100045354333753
100010834863915
100054218856415
61556161832094
100075151189343
100062086243298
100085099700409
100047235166869
100079172770825
61551061202238
100007824434496
100028152200494
100032972687114
100023040163538
100023379860233
100010080870635
100065576648969
100024482773561
61569111446352
100036925235285
100047823881721
100036126734591
100025996733769
100041648083176
100007842461261
100065135322240
100092563365505
100039087621563
100060225614607
100030953490989
100009462885196
100043266080025
100004393513148
100040712377573</textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,dương,việt anh,quang huy,tô lâm" />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Ghi chú: thuật toán sẽ chia theo vòng (round‑robin) để mỗi người có chênh lệch không quá 1 UID.</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>