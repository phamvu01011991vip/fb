<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phân UID cho từng người — Chia đều</title>
  <style>
    :root{--bg:#f7fafc;--card:#fff;--muted:#6b7280}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    textarea{width:80%; max-width: 100%;min-height:90px;padding:10px;border:1px solid #e5e7eb;border-radius:8px;font-family:monospace}
    input[type=text]{padding:8px;border-radius:6px;border:1px solid #e5e7eb}
    button{background:#111;color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    .grid{display:grid;grid-template-columns:1fr 2fr;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 1px 4px rgba(15,23,42,0.06)}
    .people-list{display:flex;flex-wrap:wrap;gap:8px}
    .person{padding:8px 10px;border-radius:8px;background:#eef2ff;border:1px solid #e0e7ff;cursor:pointer}
    .assignments{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
    .person-card{background:linear-gradient(180deg,#fff,#fafafa);padding:12px;border-radius:10px;border:1px solid #eef2ff}
    .person-card h3{margin:0 0 8px 0;font-size:16px}
    .uid-list{font-family:monospace;font-size:13px;white-space:pre-wrap}
    .tools{display:flex;gap:8px;flex-wrap:wrap}
    .small{padding:6px 8px;font-size:13px}
    .muted{color:var(--muted)}
    body {
      background-image: url(./1.jpg);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1 style="color: red;background-color: #111;">Campuchia: Nơi để anh em kiếm tiền không phải nơi để anh em đi du lịch, nghỉ dưỡng</h1>
        <div style="color: rgb(255, 0, 0); font-weight: bold; background-color: #111; margin-top: 20px;" class="muted">Không chọn được thì sẽ được tặng combo: cắt tóc + cạo râu + gõ phím + checkin đi du lịch</div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label class="muted">Danh sách UID:</label>
        <textarea id="uids">
100086794673262
100050702506750
61558473827085
61551265672852
100053471297406
100074756357472
100062158726825
100077674125199
100000599001801
100006376086608
1546119377
100024749890192
100001059811673
100023358000463
61557970869807
100008782396356
100080999281003
100088257461280
100087178695939
100082577516915
100024675649894
100088162788966
100013112148658
100054426566353
100050387889084
100074415282918
100052897742727
100050977094214
100085485114674
1621471042
100051118335936
100007732952480
100089313214995
100070993452862
100066742818125
61557519643752
100090811271730
100094391485580
100091826437937
100092247105061
100000072051436
100002800528381
100003113157766
100002498386780
100092275923514
100079177160331
100016045331540
100050870768976
100089081276167
100091605475012
100039774661266
100060588222046
100092419341485
100065438275217
100033868937966
61557829273810
61555683514674
61558604648242
100087628848734
61556644749514
100052358182440
100064495200545
100015315100543
100074224297639
100000424479092
100089852645533
61553542386678
100001816179091
100050474440276
100093388107014
100028159335145
100000190809410
100004355704613
100011416358099
100042888014097
100066762126687
100001582615771
100058725231092
100054394489109
100005643934103
100046211914560
100053773839837
100056716525054
100015732617551
100075189921852
100057473497701
100049598980279
100023311911074
100013049431763
100028079086109
100011900371556
100005210529377
100052795744808
100091578380832
100014520043040
100042393084028
100045033247375
100048773235315
100041203719485
100080354286282
61556134362820
100043590861147
61553281343756
61553913867232
61558527020433
100055469481711
100086171044116
61553968328065
61554283057597
100061628981261
100076417564361
61559806385460
100030694722754
61558186967694
100049966881670
100052676327635
100009630611922
100071728513464
61553941031495
100003337904140
1342676206
100075869239431
1303502347
100074495078719
100027713880676
100090004757464
100066239929920
100042975738290
100090382406416
100074387584722
100061567835276
100024104710725
100035043949681
100039328314309
100017111911010
1082911845
100007159172075
100050733400428
568483365
100003145035289
100066768412197
100084929954197
100023781120743
100009558071423
100014802915406
100028302915377
100088950643043
100078142857196
100022992224326
100031238940548
100010396157927
61556734971535
100092310514998
100076086691194
100001227241450
100054361045416
100028374340406
100033825341751
100080213133407
100030738824470
100068297929209
61559186501348
100028388012158
100023915444579
100071623323217
100049707242237
100083168182307
100021519052113
100089015137534
100091693044933
61556783504068
61557181070339
100081148726000
100001430706897
61556011654832
100072012700955
100094395888758
100088788708102
100013628958435
100089257713779
100006627183538
61553132601393
100090483167360
100008830362905
100043932652447
100052027241103
100016681082224
100076970613726
100055435773650
61556938686977
61558011452710
100094153577349
61555347962103
100088879937828
100048638235862
61554089710328
100055098826827
100034600981408
100024418320814
100088035743744
61555932459064
100091961943908
100013019135583
100004624934800
100088658934246
100059060858146
61550029438852
100070795371822
100004636007735
100009639271729
100035078202085
100056284715831
100072360333427
100085349222799
100090518858217
100013568885690
100039297427355
100093472013416
100008425930303
100006466215934
100024076595870
100080809186383
100081483737271
100030700936120
100040928137066
100040822803431
100052874558798
100000909686473
100047176836890
100050478551177
61559638557024
61550080040758
100013308605498
100072480707994
100088177056862
100013694808797
100055855413920
100015734730158
100015339581678
100010838629473
100003142665018
100043889371214
100047557486083
100041008338683
100058969212312
100010285334823
100094059604768
100011714849642
100022469150034
100076626618374
100090126333481
100027060382209
61559964994379
61556723340149
100025569011205
61557534634230
61551466206308
100007927651254
100023454769817
100070294816097
100036711799813
100088946760451
100010007894998
100036758000288
100087476452621
100084209172437
61550831374001
100081745485665
61558480345968
100030230820138
100040235709748
61556943052066
61556540581057
100050879490464
100075056484259
100040876995204
100022053511947
100007209100971
100002830316130
100004270549166
100043789874864
100051465245018
100095424243189
100058284212104
100035290326752
100086947696285
100023805155891
100062826713650
100026335414692
100071237950082
100091568049314
100033453462934
100014797385756
100047436892567
100003540127482
100040202363155
100090020000610
100029346292339
61558543172506
100025021839781
100015056672623
100012105186014
100033358212480
100050818328479
100003248162322
100041677670520
100048698462706
100095092905771
100029963693029
61550269841248
100083824387236
100095561320510
100013511970575
100091290326312
100080173034378
100013123061367
61557597056408
61556171473480
61552052152479
61554361960261
61553719400947
100092674611441
100004260790080
100081881850404
100093968641580
100093388642181
100039490509485
100092586512227
100093550925884
61556491707707
100088846937814
100078830980989
100032619939417
100016573815022
100023476478119
100024531585223
100070964720895
61556540528640
61557351368503
100002627440664
100007539930569
100041740012136
100090439242509
100081368702133
100095693160527
100033452281440
100059228715785
100038858500622
100084476676833
100091918402184
100085233586058
61556631135666
100023866292880
61555797184774
100029102593497
100023146342163
100089353429288
100043519772238
100092609052143
100054424659417
100009013974855
100063619899028
100091909241091
61558600300791
100053090593669
100028300622088
100007514744034
100035494451193
100003839135866
100012543784625
100011313999618
100005608699187
100010350751373
100093914092549
100004175922942
61555385871490
100064128111697
100002123567469
100009209242718
100073142284393
100085308410177
100012196904087
100093137767115
100087649434029
100087021225467
100014196252008
100050383938645
100089547218631
100081454562411
61552101857653
100015922950292
100005716639126
100092509086678
61554496126512
61551396512775
100063640924528
100057552392382
100066324949031
100030701497556
61555665131490
100010685556917
100079085913538
100003448467738
100079541527853
100077677205899
100023757782752
100011406453895
61555931573617
100031843372213
100035694441565
100093048241569
61552665113812
100058511382938
100040655627636
100084359770732
100080295820929
100009582847213
100090173390784
100053157135570
100091889572193
100055716082025
100060387229317
100007008040222
100001446501496
100024047955782
100000906038157
61552192996746
100004194185612
100088197852668
100068552050684
100012267047731
100034767994189
100042157151408
100032933852022
100035452655509
100057832153281
        </textarea>

        <div style="height:10px"></div>
        <label class="muted">Danh sách người (phân tách bằng dấu phẩy):</label>
        <input id="people" type="text" value="hoàng nam,nguyễn hương,việt anh,quang huy,tô lâm" />

        <div class="controls">
          <button id="distribute">Phân đều</button>
          <button id="clear" class="small">Xóa phân bố</button>
          <button id="copyAll" class="small">Sao chép toàn bộ JSON</button>
          <button id="exportCsv" class="small">Xuất CSV</button>
          <div style="flex:1"></div>
        </div>

        <div style="margin-top:12px" class="muted">Bác Hồ đã nói "Không có việc gì khó, chỉ sợ lòng không bền, đào núi và lấp biển, quyết chí ắt làm nên."</div>
      </div>

      <div class="card">
        <h3>Kết quả phân bổ</h3>
        <div id="summary" class="muted">Chưa phân bổ</div>
        <div style="height:12px"></div>
        <div id="assignments" class="assignments"></div>
      </div>
    </div>

  </div>

  <script>
    // Utility
    function parseUIDs(text){
      // split on whitespace or commas
      return text.split(/\s+|,+/).map(s=>s.trim()).filter(Boolean);
    }
    function parsePeople(text){
      return text.split(/,+/).map(s=>s.trim()).filter(Boolean);
    }

    function distribute(uids, people){
      // ensure stable distribution even if fewer people than uids or vice versa
      const n = people.length;
      const result = {};
      people.forEach(p=> result[p]=[]);
      if(n===0){ return result; }
      // round-robin assignment
      for(let i=0;i<uids.length;i++){
        const p = people[i % n];
        result[p].push(uids[i]);
      }
      return result;
    }

    function render(assignments){
      const container = document.getElementById('assignments');
      container.innerHTML = '';
      const people = Object.keys(assignments);
      let total=0; let min=Infinity,max=-Infinity;
      people.forEach(p=>{
        const list = assignments[p];
        total += list.length;
        min = Math.min(min, list.length);
        max = Math.max(max, list.length);
      });
      if(people.length===0){ document.getElementById('summary').textContent = 'Không có người để phân bổ'; return; }
      document.getElementById('summary').textContent = `Tổng UID: ${total} — Người: ${people.length} — mỗi người nhận: ${min} đến ${max}`;

      people.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'person-card';
        const h = document.createElement('h3');
        h.textContent = `${p} (${assignments[p].length})`;
        card.appendChild(h);

        const btns = document.createElement('div'); btns.className='tools';
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Sao chép';
        copyBtn.onclick = ()=>{ navigator.clipboard.writeText(assignments[p].join('\n')).then(()=> alert('Đã sao chép')) }
        const exportBtn = document.createElement('button'); exportBtn.className='small'; exportBtn.textContent='Xuất CSV';
        exportBtn.onclick = ()=>{ downloadCSV([[ 'name','uid' ], ...assignments[p].map(u=>[p,u])], `${p.replace(/\s+/g,'_')}.csv`) }
        btns.appendChild(copyBtn); btns.appendChild(exportBtn);
        card.appendChild(btns);

        const pre = document.createElement('div'); pre.className='uid-list'; pre.textContent = assignments[p].join('\n');
        card.appendChild(pre);
        container.appendChild(card);
      });
    }

    function downloadCSV(rows, filename){
      const lines = rows.map(r=> r.map(cell => '"' + String(cell).replaceAll('"','""') + '"').join(',')).join('\n');
      const blob = new Blob([lines], {type:'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    // DOM hookups
    document.getElementById('distribute').addEventListener('click', ()=>{
      const uidsRaw = document.getElementById('uids').value;
      const peopleRaw = document.getElementById('people').value;
      const uids = parseUIDs(uidsRaw);
      const people = parsePeople(peopleRaw);
      const assignments = distribute(uids, people);
      render(assignments);
      // store latest to window for export/copy
      window.latestAssignments = assignments;
    });

    document.getElementById('clear').addEventListener('click', ()=>{
      document.getElementById('assignments').innerHTML = '';
      document.getElementById('summary').textContent = 'Đã xóa phân bổ';
      window.latestAssignments = null;
    });

    document.getElementById('copyAll').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      navigator.clipboard.writeText(JSON.stringify(window.latestAssignments, null, 2)).then(()=> alert('Đã sao chép JSON'))
    });

    document.getElementById('exportCsv').addEventListener('click', ()=>{
      if(!window.latestAssignments){ alert('Chưa có phân bổ. Bấm Phân đều trước'); return; }
      // combine into rows [name,uid]
      const rows = [['name','uid']];
      Object.entries(window.latestAssignments).forEach(([name,uids])=>{
        uids.forEach(u=> rows.push([name,u]));
      });
      downloadCSV(rows, 'phan_bo_uid.csv');
    });

    // auto-distribute on load
    document.getElementById('distribute').click();
  </script>
</body>
</html>